    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Pet Products</title>
        <link rel="stylesheet" href="../css/style.css">
        <link rel="stylesheet" href="../css/responsive.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    </head>
    <body>
        <header>
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 0 1em;">
        <img id="logo" src="../img/logo/schnauzer-face-svgrepo-com.svg" alt="Logo">
        <h1>PAW HAVEN</h1>
            <select id="menu" name="menu">
                <option value="">Main menu</option> <!-- Empty value for placeholder -->
                <option value="../index.html">Home</option>
                <option value="kontakt.html">Kontakt</option>
                <option value="o-nama.html">O nama</option>
            </select>
        </div>
        </header>
        <main id="proizvodi">
            <nav aria-label="Breadcrumb">
                <ol class="breadcrumb">
                    <li><a href="../index.html">Home</a></li>
                    <li>Shop</li>
                </ol>
            </nav>
            <h1>Quality Pet Supplies for Dogs & Cats</h1>
            <a href="../pages/kosarica.html" id="cart-toggle" class="cart-link">ðŸ›’ Cart (<span id="cart-count">0</span>)</a>
            <div class="container">
                <aside class="sidebar">
                    <h3>Filter By</h3>

                    <div class="filter-group">
                    <h4>Category</h4>
                    <label><input type="checkbox" name="category" value="dog"> Dog Supplies</label><br>
                    <label><input type="checkbox" name="category" value="cat"> Cat Supplies</label>
                    </div>

                    <div class="filter-group">
                    <h4>Price</h4>
                    <label><input type="radio" name="price" value="under20"> Under $20</label><br>
                    <label><input type="radio" name="price" value="20to50"> $20â€“$50</label><br>
                    <label><input type="radio" name="price" value="over50"> Over $50</label><br>
                    <label><input type="radio" name="price" value="all" checked> All Prices</label>
                    </div>
                </aside>

            <div class="main-content">
                <div class="sorting">
                    <label for="sort">Sort by:</label>
                    <select id="sort">
                    <option value="popular">Most Popular</option>
                    <option value="price-low-high">Price: Low to High</option>
                    <option value="price-high-low">Price: High to Low</option>
                    <option value="newest">Newest First</option>
                    </select>
                </div>

                <div class="product-grid">
                    <!-- Products will be dynamically inserted here by JavaScript -->
                </div>

                <div class="pagination">
                    <!-- Pagination links will be generated by JavaScript -->
                </div>
            </div>
        </main>
        <script src="../js/cart.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', async () => { // Make it async
                // ... (cart count logic) ...

                const productGrid = document.querySelector('.product-grid');
                let allProductsData = []; // This will be populated from JSON

                const sortSelect = document.getElementById('sort');
                const categoryCheckboxes = document.querySelectorAll('.sidebar .filter-group input[type="checkbox"][name="category"]');
                const priceRadios = document.querySelectorAll('.sidebar .filter-group input[type="radio"][name="price"]');
                const paginationContainer = document.querySelector('.pagination');

                const productsPerPage = 6;
                let currentPage = 1;
                let filteredAndSortedProducts = [];

                async function loadAndInitializeProducts() {
                    try {
                        const response = await fetch('../data/products.json'); // Adjust path if your products.json is elsewhere
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const productsJson = await response.json();

                        allProductsData = productsJson.map((prod, index) => {
                            // Create the product card element dynamically
                            const card = document.createElement('div');
                            card.classList.add('product-card');
                            // Set data attributes on the card itself for easy access if needed by cart.js or details navigation
                            card.dataset.name = prod.name;
                            card.dataset.price = prod.price;
                            card.dataset.image = prod.image;
                            card.dataset.sku = prod.sku;
                            card.dataset.category = prod.category;
                            card.dataset.shortDescription = prod.shortDescription;
                            card.dataset.longDescription = prod.longDescription;


                            card.innerHTML = `
                                <img class="product-image" src="${prod.image}" alt="${prod.name}">
                                <h4>${prod.name}</h4>
                                <p>$${parseFloat(prod.price).toFixed(2)}</p>
                                <div class="buttons-container">
                                    <button class="add-to-cart">Add to Cart</button>
                                    <button class="details-button">View Details</button>
                                </div>
                            `;
                            return {
                                element: card, // The dynamically created DOM element
                                id: index, // Original index for stable "popular" sort
                                name: prod.name,
                                price: parseFloat(prod.price),
                                image: prod.image,
                                sku: prod.sku,
                                category: prod.category,
                                shortDescription: prod.shortDescription,
                                longDescription: prod.longDescription,
                            };
                        });

                        applyFiltersAndSort(); // Initial filter, sort, and render

                    } catch (error) {
                        console.error("Could not fetch or initialize products:", error);
                        productGrid.innerHTML = "<p style='color:white; text-align:center;'>Error loading products. Please try again later.</p>";
                    }
                }


                function applyFiltersAndSort() {
                    let productsToShow = [...allProductsData];

                    // 1. Category Filter
                    const selectedCategories = Array.from(categoryCheckboxes)
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);

                    if (selectedCategories.length > 0) {
                        productsToShow = productsToShow.filter(p => selectedCategories.includes(p.category));
                    }

                    // 2. Price Filter
                    const selectedPriceRadio = Array.from(priceRadios).find(radio => radio.checked);
                    if (selectedPriceRadio && selectedPriceRadio.value !== "all") {
                        const priceValue = selectedPriceRadio.value;
                        productsToShow = productsToShow.filter(p => {
                            if (priceValue === 'under20') return p.price < 20;
                            if (priceValue === '20to50') return p.price >= 20 && p.price <= 50;
                            if (priceValue === 'over50') return p.price > 50;
                            return true;
                        });
                    }

                    // 3. Sorting
                    const sortBy = sortSelect.value;
                    switch (sortBy) {
                        case 'price-low-high':
                            productsToShow.sort((a, b) => a.price - b.price);
                            break;
                        case 'price-high-low':
                            productsToShow.sort((a, b) => b.price - a.price);
                            break;
                        case 'newest':
                            productsToShow.sort((a, b) => b.id - a.id); // Assuming higher id means newer
                            break;
                        case 'popular':
                        default:
                            productsToShow.sort((a, b) => a.id - b.id); // Default order
                            break;
                    }

                    filteredAndSortedProducts = productsToShow;
                    currentPage = 1;
                    renderProductGrid();
                    updatePaginationControls();
                }

                function renderProductGrid() {
                    productGrid.innerHTML = '';

                    const startIndex = (currentPage - 1) * productsPerPage;
                    const endIndex = startIndex + productsPerPage;
                    const productsToDisplayOnPage = filteredAndSortedProducts.slice(startIndex, endIndex);

                    if (productsToDisplayOnPage.length === 0) {
                        const noProductsMessage = document.createElement('p');
                        noProductsMessage.textContent = 'No products match your criteria.';
                        noProductsMessage.style.color = 'white';
                        noProductsMessage.style.textAlign = 'center';
                        noProductsMessage.style.gridColumn = '1 / -1';
                        productGrid.appendChild(noProductsMessage);
                    } else {
                        productsToDisplayOnPage.forEach(productData => {
                            // Attach "View Details" listener specifically to this dynamically created element's button
                            const detailsButton = productData.element.querySelector('.details-button');
                            if (detailsButton) {
                                detailsButton.addEventListener('click', () => {
                                    const params = new URLSearchParams();
                                    params.append('name', productData.name);
                                    params.append('price', String(productData.price));
                                    params.append('image', productData.image);
                                    params.append('sku', productData.sku);
                                    params.append('shortDescription', productData.shortDescription);
                                    params.append('longDescription', productData.longDescription);
                                    params.append('category', productData.category);
                                    window.location.href = `../pages/pojedinacni-proizvod.html?${params.toString()}`;
                                });
                            }
                            // The "Add to Cart" button will be handled by the event delegation in cart.js
                            // using the data-* attributes set on productData.element (the card itself).
                            productGrid.appendChild(productData.element);
                        });
                    }
                }

                function updatePaginationControls() {
                    paginationContainer.innerHTML = '';
                    const totalPages = Math.ceil(filteredAndSortedProducts.length / productsPerPage);

                    if (totalPages <= 1) {
                        return;
                    }

                    if (currentPage > 1) {
                        const prevButton = document.createElement('a');
                        prevButton.href = '#prev';
                        prevButton.classList.add('page-link');
                        prevButton.innerHTML = 'Â« Prev';
                        prevButton.addEventListener('click', (e) => {
                            e.preventDefault();
                            currentPage--;
                            renderProductGrid();
                            updatePaginationControls();
                        });
                        paginationContainer.appendChild(prevButton);
                    }

                    for (let i = 1; i <= totalPages; i++) {
                        const pageLink = document.createElement('a');
                        pageLink.href = '#' + i;
                        pageLink.classList.add('page-link');
                        pageLink.textContent = i;
                        if (i === currentPage) {
                            pageLink.classList.add('active');
                        }
                        pageLink.addEventListener('click', (e) => {
                            e.preventDefault();
                            currentPage = i;
                            renderProductGrid();
                            updatePaginationControls();
                        });
                        paginationContainer.appendChild(pageLink);
                    }

                    if (currentPage < totalPages) {
                        const nextButton = document.createElement('a');
                        nextButton.href = '#next';
                        nextButton.classList.add('page-link');
                        nextButton.innerHTML = 'Next Â»';
                        nextButton.addEventListener('click', (e) => {
                            e.preventDefault();
                            currentPage++;
                            renderProductGrid();
                            updatePaginationControls();
                        });
                        paginationContainer.appendChild(nextButton);
                    }
                }

                // Event Listeners
                sortSelect.addEventListener('change', applyFiltersAndSort);
                priceRadios.forEach(radio => radio.addEventListener('change', applyFiltersAndSort));
                categoryCheckboxes.forEach(checkbox => checkbox.addEventListener('change', applyFiltersAndSort));

                // Initial Load
                await loadAndInitializeProducts();
            });
    </script>
    </body>
    </html>